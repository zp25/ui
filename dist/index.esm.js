import{Subject as t,machine as e}from"zp-lib";function n(t){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function i(t,e,n){return e&&r(t.prototype,e),n&&r(t,n),t}function a(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function s(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function u(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?s(n,!0).forEach((function(e){a(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):s(n).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function c(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&f(t,e)}function l(t){return(l=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function f(t,e){return(f=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function h(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function d(t,e){return!e||"object"!=typeof e&&"function"!=typeof e?h(t):e}function p(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if(!(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t)))return;var n=[],o=!0,r=!1,i=void 0;try{for(var a,s=t[Symbol.iterator]();!(o=(a=s.next()).done)&&(n.push(a.value),!e||n.length!==e);o=!0);}catch(t){r=!0,i=t}finally{try{o||null==s.return||s.return()}finally{if(r)throw i}}return n}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var y=function(e){function n(t){var e;if(o(this,n),e=d(this,l(n).call(this)),!t)throw new Error("Please choose a group");return e._group=String(t),e}return c(n,t),i(n,[{key:"group",get:function(){return this._group}}]),n}(),v=function(t){function e(){var t,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"main",i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(o(this,e),a(h(t=d(this,l(e).call(this,r))),"isAutoplay",!1),a(h(t),"timeoutID",NaN),"object"!==n(i)||!i)throw new TypeError("not an Object");var s=i.length,u=i.focus,c=i.delay;return t._options={length:~~s||1,focus:~~u||1,delay:~~c||8e3},Object.freeze(t._options),t.state={focus:0},t}return c(e,y),i(e,[{key:"setAutoplay",value:function(){if(this.isAutoplay){var t=this.options.delay;this.timeoutID=setTimeout(this.play.bind(this),t)}}},{key:"clearAutoplay",value:function(){this.timeoutID&&(clearTimeout(this.timeoutID),this.timeoutID=NaN)}},{key:"go",value:function(t){var e=this.options,n=e.focus,o=e.length,r=~~t;this.setState({focus:r>0&&r<=o?r:n}),this.setAutoplay()}},{key:"next",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=this.options,n=e.focus,o=e.length,r=~~this.focus;return r?t?r<=1?o:r-1:r>=o?1:r+1:n}},{key:"play",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.clearAutoplay(),"boolean"==typeof t?this.go(this.next(t)):this.go(t)}},{key:"autoplay",value:function(){this.isAutoplay=!0,this.play()}},{key:"pause",value:function(){this.isAutoplay=!1,this.clearAutoplay()}},{key:"options",get:function(){return u({},this._options)}},{key:"focus",get:function(){return this.state.focus}}]),e}(),m="--banner-length",g=0,b=1,w=2,O=-1,E=function(t){var e=t.replace,n=void 0===e?"replace":e,o=t.done,r=void 0===o?"done":o,i=t.error,a=void 0===i?"error":i;return{update:function(t){var e=t.loader,o=t.status;1===o?e.classList.remove(n):o===w?e.classList.add(r):-1===o&&e.classList.add(a)}}},S=function(t){function e(){var t,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"main",i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(o(this,e),t=d(this,l(e).call(this,r)),"object"!==n(i)||!i)throw new TypeError("not an Object");var a=i.replace,s=void 0===a?"replace":a,u=i.done,c=void 0===u?"done":u,f=i.error,h=void 0===f?"error":f,p=i.image,y=void 0===p?"image":p;return t._options={replace:s,done:c,error:h,image:y},Object.freeze(t._options),t.state={loader:null,status:w},t.attach(E(t.options)),t}return c(e,y),i(e,null,[{key:"inview",value:function(t){var e=t.getBoundingClientRect(),n=e.top;return n+e.height>0&&n<window.innerHeight}},{key:"loadImage",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"image",n=["src","alt","crossorigin"];return new Promise((function(o,r){var i=new Image;i.classList.add(e,"".concat(e,"--full")),Object.entries(t.dataset).forEach((function(t){var e=p(t,2),o=e[0],r=e[1];n.includes(o)?i[o]=r:i.dataset[o]=r})),i.onload=function(){o(i)},i.onerror=function(){r(i.src)}}))}}]),i(e,[{key:"done",value:function(t,e){t.appendChild(e),this.setState({loader:t,status:w})}},{key:"error",value:function(t){this.setState({loader:t,status:-1})}},{key:"load",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"image-loader",n=this.options,o=n.replace,r=n.image,i=Array.from(document.getElementsByClassName("".concat(e," ").concat(o)));return Promise.all(i.map((function(e){return!!t.constructor.inview(e)&&(t.setState({loader:e,status:1}),t.constructor.loadImage(e,r).then((function(n){return t.done(e,n),{src:n.src,done:!0}}),(function(n){return t.error(e),{src:n,error:!0}})))})))}},{key:"options",get:function(){return u({},this._options)}}]),e}(),k=e({visible:{MODALCLOSE:"hidden",MODALOPEN:"visible"},hidden:{MODALOPEN:"visible"}}),P=function(t){function e(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"main";return o(this,e),(t=d(this,l(e).call(this,n))).state={modal:!1,dialog:""},t}return c(e,y),i(e,null,[{key:"currentState",value:function(t){if("boolean"!=typeof t)throw new TypeError("double check modal state");return t?"visible":"hidden"}}]),i(e,[{key:"prompt",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",e=this.state.modal,n=this.constructor.currentState(e),o=k(n)("MODALOPEN");return"visible"===o&&(this.setState({modal:!0,dialog:t.toString()}),!0)}},{key:"loading",value:function(){this.prompt("loading")}},{key:"open",value:function(){this.prompt()}},{key:"close",value:function(){var t=this.state.modal,e=this.constructor.currentState(t);return"hidden"===k(e)("MODALCLOSE")&&(this.setState({modal:!1,dialog:""}),!0)}}]),e}(),j=e({start:{SWIPEMOVE:"move",SWIPEEND:"end"},move:{SWIPEMOVE:"move",SWIPEEND:"end"},end:{SWIPESTART:"start"}}),_=function(t){function e(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"main";return o(this,e),(t=d(this,l(e).call(this,n))).state={swipe:"end",x0:0,y0:0,x1:0,y1:0},t}return c(e,y),i(e,null,[{key:"unify",value:function(t){return t.changedTouches?t.changedTouches[0]:t}},{key:"dimention",value:function(t,e,n,o){var r=n-t,i=o-e;return{dx:r,dy:i,absDx:Math.abs(r),absDy:Math.abs(i)}}},{key:"isEdge",value:function(t,e,n){return 1===e&&n>0||e===t&&n<0}}]),i(e,[{key:"dispatch",value:function(t){var e=this;return function(n){var o=e.state.swipe,r=j(o)(t);if(r){var i=e.constructor.unify(n),a={clientX:i.clientX,clientY:i.clientY};"start"===r?e.swipeStart(a):"move"===r?e.swipeMove(a):"end"===r&&e.swipeEnd(a)}}}},{key:"swipeStart",value:function(t){var e=t.clientX,n=t.clientY;this.setState({swipe:"start",x0:e,y0:n})}},{key:"swipeMove",value:function(t){var e=t.clientX,n=t.clientY;this.setState({swipe:"move",x1:e,y1:n})}},{key:"swipeEnd",value:function(t){var e=t.clientX,n=t.clientY;this.setState({swipe:"end",x1:e,y1:n})}},{key:"start",value:function(t){this.dispatch("SWIPESTART")(t)}},{key:"move",value:function(t){this.dispatch("SWIPEMOVE")(t)}},{key:"end",value:function(t){this.dispatch("SWIPEEND")(t)}}]),e}(),D=function(t){return{update:function(e){var n=e.focus;t.style.setProperty("--banner-focus",n)}}},x=function(t,e){return{start:function(){e.classList.add("carousel__main--swipe")},move:function(n){var o=n.dx;if(n.absDx>=n.absDy){var r=t.length,i=t.focus,a=t.offsetWidth,s=o;_.isEdge(r,i,o)&&(s=.42*Math.sin(o/a*Math.PI*.5)*a),e.style.setProperty("--banner-dx","".concat(s,"px"))}},end:function(n){var o=n.dx,r=n.absDx,i=n.absDy,a=t.length,s=t.focus,u=t.offsetWidth;e.classList.remove("carousel__main--swipe");var c=r/u,l=_.isEdge(a,s,o)?1:1-c;return e.style.setProperty("--banner-dx","0px"),e.style.setProperty("--banner-duration",l),c<.1||r<i?(t.setAutoplay(),!1):(t.play(Math.sign(o)>0),!0)},update:function(t){var e=t.swipe,n=t.x0,o=t.y0,r=t.x1,i=t.y1;"start"===e?this.start():"move"===e?this.move(_.dimention(n,o,r,i)):"end"===e&&this.end(_.dimention(n,o,r,i))}}},A=function(t){function e(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"main",r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};o(this,e);var i=".carousel".concat(n?'[data-group="'.concat(n,'"]'):""),a=document.querySelectorAll("".concat(i," .slide-banner")),s=a?a.length:1;if((t=d(this,l(e).call(this,n,u({length:s},r)))).carousel=document.querySelector(i),!t.carousel)throw new Error("can not find target ".concat(i));if(t.main=t.carousel.querySelector(".carousel__main"),!t.main)throw new Error("can not find target .carousel__main");return t.main.style.setProperty(m,s),t.attach(D(t.main)),t.swipe=new _(n),t.swipe.attach(x(h(t),t.main)),t.bindListeners(),t}return c(e,v),i(e,[{key:"bindListeners",value:function(){var t=this.swipe,e=t.start,n=t.move,o=t.end,r=e.bind(this.swipe),i=n.bind(this.swipe),a=o.bind(this.swipe);this.main.addEventListener("mousedown",r,!1),this.main.addEventListener("touchstart",r,!1),this.main.addEventListener("mousemove",i,!1),this.main.addEventListener("touchmove",i,!1),this.main.addEventListener("mouseup",a,!1),this.main.addEventListener("touchend",a,!1),this.main.addEventListener("mouseleave",a,!1)}},{key:"length",get:function(){return this.options.length}},{key:"offsetWidth",get:function(){return this.carousel.offsetWidth}}]),e}();export{v as Carousel,y as Group,S as ImageLoader,P as Modal,w as PROCESS_DONE,O as PROCESS_ERROR,g as PROCESS_PENDING,b as PROCESS_START,_ as Swipe,A as SwipeCarousel};
//# sourceMappingURL=index.esm.js.map
