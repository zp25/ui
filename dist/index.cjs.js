"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var zpLib=require("zp-lib");function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),e}function _defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function ownKeys(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function _objectSpread2(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(r,!0).forEach((function(t){_defineProperty(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ownKeys(r).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_setPrototypeOf(e,t)}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _possibleConstructorReturn(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?_assertThisInitialized(e):t}function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_nonIterableRest()}function _arrayWithHoles(e){if(Array.isArray(e))return e}function _iterableToArrayLimit(e,t){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)){var r=[],n=!0,o=!1,i=void 0;try{for(var s,a=e[Symbol.iterator]();!(n=(s=a.next()).done)&&(r.push(s.value),!t||r.length!==t);n=!0);}catch(e){o=!0,i=e}finally{try{n||null==a.return||a.return()}finally{if(o)throw i}}return r}}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}var Group=function(e){function t(e){var r;if(_classCallCheck(this,t),r=_possibleConstructorReturn(this,_getPrototypeOf(t).call(this)),!e)throw new Error("Please choose a group");return r._group=String(e),r}return _inherits(t,zpLib.Subject),_createClass(t,[{key:"group",get:function(){return this._group}}]),t}(),Carousel=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"main",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(_classCallCheck(this,t),_defineProperty(_assertThisInitialized(e=_possibleConstructorReturn(this,_getPrototypeOf(t).call(this,r))),"isAutoplay",!1),_defineProperty(_assertThisInitialized(e),"timeoutID",NaN),"object"!==_typeof(n)||!n)throw new TypeError("not an Object");var o=n.length,i=n.focus,s=n.delay;return e._options={length:~~o||1,focus:~~i||1,delay:~~s||8e3},Object.freeze(e._options),e.state={focus:0},e}return _inherits(t,Group),_createClass(t,[{key:"setAutoplay",value:function(){if(this.isAutoplay){var e=this.options.delay;this.timeoutID=setTimeout(this.play.bind(this),e)}}},{key:"clearAutoplay",value:function(){this.timeoutID&&(clearTimeout(this.timeoutID),this.timeoutID=NaN)}},{key:"go",value:function(e){var t=this.options,r=t.focus,n=t.length,o=~~e;this.setState({focus:o>0&&o<=n?o:r}),this.setAutoplay()}},{key:"next",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this.options,r=t.focus,n=t.length,o=~~this.focus;return o?e?o<=1?n:o-1:o>=n?1:o+1:r}},{key:"play",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.clearAutoplay(),"boolean"==typeof e?this.go(this.next(e)):this.go(e)}},{key:"autoplay",value:function(){this.isAutoplay=!0,this.play()}},{key:"pause",value:function(){this.isAutoplay=!1,this.clearAutoplay()}},{key:"options",get:function(){return _objectSpread2({},this._options)}},{key:"focus",get:function(){return this.state.focus}}]),t}(),PROP_LEN="--banner-length",PROP_FOCUS="--banner-focus",PROP_DX="--banner-dx",PROP_DURATION="--banner-duration",PROCESS_PENDING=0,PROCESS_START=1,PROCESS_DONE=2,PROCESS_ERROR=-1,styleObserver=function(e){var t=e.replace,r=void 0===t?"replace":t,n=e.done,o=void 0===n?"done":n,i=e.error,s=void 0===i?"error":i;return{update:function(e){var t=e.loader,n=e.status;n===PROCESS_START?t.classList.remove(r):n===PROCESS_DONE?t.classList.add(o):n===PROCESS_ERROR&&t.classList.add(s)}}},ImageLoader=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"main",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(_classCallCheck(this,t),e=_possibleConstructorReturn(this,_getPrototypeOf(t).call(this,r)),"object"!==_typeof(n)||!n)throw new TypeError("not an Object");var o=n.replace,i=void 0===o?"replace":o,s=n.done,a=void 0===s?"done":s,u=n.error,c=void 0===u?"error":u,l=n.image,p=void 0===l?"image":l;return e._options={replace:i,done:a,error:c,image:p},Object.freeze(e._options),e.state={loader:null,status:PROCESS_DONE},e.attach(styleObserver(e.options)),e}return _inherits(t,Group),_createClass(t,null,[{key:"inview",value:function(e){var t=e.getBoundingClientRect(),r=t.top;return r+t.height>0&&r<window.innerHeight}},{key:"loadImage",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"image",r=["src","alt","crossorigin"];return new Promise((function(n,o){var i=new Image;i.classList.add(t,"".concat(t,"--full")),Object.entries(e.dataset).forEach((function(e){var t=_slicedToArray(e,2),n=t[0],o=t[1];r.includes(n)?i[n]=o:i.dataset[n]=o})),i.onload=function(){n(i)},i.onerror=function(){o(i.src)}}))}}]),_createClass(t,[{key:"done",value:function(e,t){e.appendChild(t),this.setState({loader:e,status:PROCESS_DONE})}},{key:"error",value:function(e){this.setState({loader:e,status:PROCESS_ERROR})}},{key:"load",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"image-loader",r=this.options,n=r.replace,o=r.image,i=Array.from(document.getElementsByClassName("".concat(t," ").concat(n)));return Promise.all(i.map((function(t){return!!e.constructor.inview(t)&&(e.setState({loader:t,status:PROCESS_START}),e.constructor.loadImage(t,o).then((function(r){return e.done(t,r),{src:r.src,done:!0}}),(function(r){return e.error(t),{src:r,error:!0}})))})))}},{key:"options",get:function(){return _objectSpread2({},this._options)}}]),t}(),ModalDict={visible:{MODALCLOSE:"hidden",MODALOPEN:"visible"},hidden:{MODALOPEN:"visible"}},modalMachine=zpLib.machine(ModalDict),Modal=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"main";return _classCallCheck(this,t),(e=_possibleConstructorReturn(this,_getPrototypeOf(t).call(this,r))).state={modal:!1,dialog:""},e}return _inherits(t,Group),_createClass(t,null,[{key:"currentState",value:function(e){if("boolean"!=typeof e)throw new TypeError("double check modal state");return e?"visible":"hidden"}}]),_createClass(t,[{key:"prompt",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=this.state.modal,r=this.constructor.currentState(t),n=modalMachine(r)("MODALOPEN");return"visible"===n&&(this.setState({modal:!0,dialog:e.toString()}),!0)}},{key:"loading",value:function(){this.prompt("loading")}},{key:"open",value:function(){this.prompt()}},{key:"close",value:function(){var e=this.state.modal,t=this.constructor.currentState(e);return"hidden"===modalMachine(t)("MODALCLOSE")&&(this.setState({modal:!1,dialog:""}),!0)}}]),t}(),SwipeDict={start:{SWIPEMOVE:"move",SWIPEEND:"end"},move:{SWIPEMOVE:"move",SWIPEEND:"end"},end:{SWIPESTART:"start"}},swipeMachine=zpLib.machine(SwipeDict),Swipe=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"main";return _classCallCheck(this,t),(e=_possibleConstructorReturn(this,_getPrototypeOf(t).call(this,r))).state={swipe:"end",x0:0,y0:0,x1:0,y1:0},e}return _inherits(t,Group),_createClass(t,null,[{key:"unify",value:function(e){return e.changedTouches?e.changedTouches[0]:e}},{key:"dimention",value:function(e,t,r,n){var o=r-e,i=n-t;return{dx:o,dy:i,absDx:Math.abs(o),absDy:Math.abs(i)}}},{key:"isEdge",value:function(e,t,r){return 1===t&&r>0||t===e&&r<0}}]),_createClass(t,[{key:"dispatch",value:function(e){var t=this;return function(r){var n=t.state.swipe,o=swipeMachine(n)(e);if(o){var i=t.constructor.unify(r),s={clientX:i.clientX,clientY:i.clientY};"start"===o?t.swipeStart(s):"move"===o?t.swipeMove(s):"end"===o&&t.swipeEnd(s)}}}},{key:"swipeStart",value:function(e){var t=e.clientX,r=e.clientY;this.setState({swipe:"start",x0:t,y0:r})}},{key:"swipeMove",value:function(e){var t=e.clientX,r=e.clientY;this.setState({swipe:"move",x1:t,y1:r})}},{key:"swipeEnd",value:function(e){var t=e.clientX,r=e.clientY;this.setState({swipe:"end",x1:t,y1:r})}},{key:"start",value:function(e){this.dispatch("SWIPESTART")(e)}},{key:"move",value:function(e){this.dispatch("SWIPEMOVE")(e)}},{key:"end",value:function(e){this.dispatch("SWIPEEND")(e)}}]),t}(),bannerObserver=function(e){return{update:function(t){var r=t.focus;e.style.setProperty(PROP_FOCUS,r)}}},swipeObserver=function(e,t){return{start:function(){t.classList.add("carousel__main--swipe")},move:function(r){var n=r.dx;if(r.absDx>=r.absDy){var o=e.length,i=e.focus,s=e.offsetWidth,a=n;Swipe.isEdge(o,i,n)&&(a=.42*Math.sin(n/s*Math.PI*.5)*s),t.style.setProperty(PROP_DX,"".concat(a,"px"))}},end:function(r){var n=r.dx,o=r.absDx,i=r.absDy,s=e.length,a=e.focus,u=e.offsetWidth;t.classList.remove("carousel__main--swipe");var c=o/u,l=Swipe.isEdge(s,a,n)?1:1-c;return t.style.setProperty(PROP_DX,"0px"),t.style.setProperty(PROP_DURATION,l),c<.1||o<i?(e.setAutoplay(),!1):(e.play(Math.sign(n)>0),!0)},update:function(e){var t=e.swipe,r=e.x0,n=e.y0,o=e.x1,i=e.y1;"start"===t?this.start():"move"===t?this.move(Swipe.dimention(r,n,o,i)):"end"===t&&this.end(Swipe.dimention(r,n,o,i))}}},SwipeCarousel=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"main",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};_classCallCheck(this,t);var o=".carousel".concat(r?'[data-group="'.concat(r,'"]'):""),i=document.querySelectorAll("".concat(o," .slide-banner")),s=i?i.length:1;if((e=_possibleConstructorReturn(this,_getPrototypeOf(t).call(this,r,_objectSpread2({length:s},n)))).carousel=document.querySelector(o),!e.carousel)throw new Error("can not find target ".concat(o));if(e.main=e.carousel.querySelector(".carousel__main"),!e.main)throw new Error("can not find target .carousel__main");return e.main.style.setProperty(PROP_LEN,s),e.attach(bannerObserver(e.main)),e.swipe=new Swipe(r),e.swipe.attach(swipeObserver(_assertThisInitialized(e),e.main)),e.bindListeners(),e}return _inherits(t,Carousel),_createClass(t,[{key:"bindListeners",value:function(){var e=this.swipe,t=e.start,r=e.move,n=e.end,o=t.bind(this.swipe),i=r.bind(this.swipe),s=n.bind(this.swipe);this.main.addEventListener("mousedown",o,!1),this.main.addEventListener("touchstart",o,!1),this.main.addEventListener("mousemove",i,!1),this.main.addEventListener("touchmove",i,!1),this.main.addEventListener("mouseup",s,!1),this.main.addEventListener("touchend",s,!1),this.main.addEventListener("mouseleave",s,!1)}},{key:"length",get:function(){return this.options.length}},{key:"offsetWidth",get:function(){return this.carousel.offsetWidth}}]),t}();exports.Carousel=Carousel,exports.Group=Group,exports.ImageLoader=ImageLoader,exports.Modal=Modal,exports.PROCESS_DONE=PROCESS_DONE,exports.PROCESS_ERROR=PROCESS_ERROR,exports.PROCESS_PENDING=PROCESS_PENDING,exports.PROCESS_START=PROCESS_START,exports.Swipe=Swipe,exports.SwipeCarousel=SwipeCarousel;
//# sourceMappingURL=index.cjs.js.map
